services:
  iris:
    container_name: iristool
    build:
      context: .        # Build using local Dockerfile
      dockerfile: Dockerfile
    image: iristool:latest  # Custom project image, not the base one
    init: true
    restart: unless-stopped
    volumes:
      - ./storage:/durable
    ports:
      - "9092:52773"  # Management Portal / REST APIs
      - "9091:1972"   # SuperServer port
    environment:
      - ISC_DATA_DIRECTORY=/durable/iris
    # command: --password-file /durable/password/password.txt
    # ------------------------------------------------------------------------------
    # Entrypoint: this runs your entrypoint.sh, which will start IRIS,
    # import your code into the current USER namespace, and then hand over
    # control to the default IRIS entrypoint.
    # Logs can be found in /opt/irisapp/logs/entrypoint.log and in Docker Desktop either.
    # Logs can be print in terminal by using command: docker exec -it <container_name> cat /opt/irisapp/logs/entrypoint.log
    # ------------------------------------------------------------------------------
    entrypoint: ["/opt/irisapp/entrypoint.sh"]

  ollama:
    image: ollama/ollama:latest
    container_name: ollama_iristool
    pull_policy: always
    tty: true
    restart: unless-stopped
    ports:
      - 11424:11434
    volumes:
      - ./ollama_entrypoint.sh:/entrypoint.sh
    environment:
      - 'OLLAMA_MAX_LOADED_MODELS=4'
      - 'OLLAMA_NUM_PARALLEL=4'
      - 'OLLAMA_KEEP_ALIVE=-1'
    entrypoint: ["/entrypoint.sh"]
